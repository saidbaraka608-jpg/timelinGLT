<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>BARAKA SAID Pro 2026</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <style>
    :root {
      --android-navy: #0f172a;
      --android-blue: #2196F3;
      --android-green: #4CAF50;
      --android-orange: #FF9800;
      --bg-gray: #f5f7fa;
      --card-white: #ffffff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Roboto', 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
    body { background: var(--bg-gray); color: #333; padding-bottom: 30px; line-height: 1.6; }

    /* الهيدر بنمط أندرويد */
    .header { background: var(--android-navy); color: white; padding: 16px; display: flex; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .header i { font-size: 1.4rem; cursor: pointer; }
    .header-title { flex: 1; text-align: center; font-weight: 500; font-size: 1.1rem; }

    /* القائمة الجانبية */
    .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1999; display: none; }
    .sidebar { height: 100%; width: 0; position: fixed; z-index: 2000; top: 0; right: 0; background: var(--android-navy); overflow-x: hidden; transition: 0.3s; color: white; display: flex; flex-direction: column; }
    .sidebar-header { padding: 30px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .sidebar-item { padding: 16px 24px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); color: #cbd5e1; text-decoration: none; cursor: pointer; }

    /* ساعة العمل (Timer) */
    .card-timer { background: #1e293b; color: white; margin: 12px; padding: 20px; border-radius: 16px; text-align: center; }
    #display-clock { font-size: 2.8rem; font-weight: 700; font-family: monospace; color: var(--android-blue); margin-bottom: 10px; }
    .time-stats { display: flex; justify-content: space-between; background: rgba(255,255,255,0.05); padding: 12px; border-radius: 12px; margin-bottom: 15px; }
    .time-stats b { display: block; font-size: 1rem; color: #fff; }
    
    .btn-row { display: flex; gap: 10px; }
    .btn-android { border: none; padding: 14px; border-radius: 12px; font-weight: bold; cursor: pointer; flex: 1; text-transform: uppercase; font-size: 0.9rem; }

    /* الحاويات والحقول */
    .container { max-width: 600px; margin: auto; padding: 8px; }
    .section-title { font-size: 0.9rem; font-weight: 700; color: #64748b; margin: 20px 8px 10px; text-transform: uppercase; }
    .card { background: var(--card-white); border-radius: 16px; padding: 16px; margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    
    label { display: block; font-size: 0.8rem; font-weight: 600; color: #7f8c8d; margin-bottom: 6px; }
    select, input { width: 100%; padding: 14px; border: 1.5px solid #eceff1; border-radius: 12px; font-size: 1rem; margin-bottom: 16px; background: #fafafa; outline: none; }
    select:focus, input:focus { border-color: var(--android-blue); background: white; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

    .btn-main { width: 100%; background: var(--android-blue); color: white; border: none; padding: 18px; border-radius: 16px; font-size: 1.1rem; font-weight: bold; box-shadow: 0 4px 6px rgba(33, 150, 243, 0.2); }

    /* النتيجة والسجل */
    .result-box { background: #e8f5e9; border: 2px solid var(--android-green); border-radius: 16px; padding: 20px; margin-top: 15px; text-align: center; display: none; }
    .price { font-size: 2.5rem; font-weight: 900; color: #2e7d32; }

    .history-item { background: white; padding: 14px; border-radius: 14px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--android-blue); }
    .hist-meta { font-size: 0.8rem; color: #94a3b8; }
    .delete-icon { color: #f44336; padding: 10px; cursor: pointer; }

    .btn-close-menu { background: var(--android-green); color: white; border: none; padding: 14px; width: 90%; margin: 20px auto; border-radius: 12px; font-weight: bold; }
  </style>
</head>
<body onload="initApp()">

<div id="overlay" class="sidebar-overlay" onclick="closeSidebar()"></div>

<div id="mySidebar" class="sidebar">
  <div class="sidebar-header">
    <h2 style="color:var(--android-blue)">BARAKA SAID</h2>
    <p style="font-size:0.8rem; opacity:0.6">Android Edition V16</p>
  </div>
  <div class="sidebar-item">
    <i class="fas fa-language"></i> <span id="side_lang">اللغة</span>
    <select id="langSwitcher" onchange="applyLanguage(); autoSave();" style="margin:0; width:auto; padding:4px;">
      <option value="ar">العربية</option>
      <option value="fr">Français</option>
    </select>
  </div>
  <div class="sidebar-item" onclick="clearHistory()" style="color:#ef5350;">
    <i class="fas fa-trash-alt"></i> <span id="side_clear">مسح السجل</span>
  </div>
  <div style="margin-top:auto; padding:20px; font-size:0.75rem; text-align:center; color:#94a3b8;">
    صدقة جارية لوالدتي رحمها الله
  </div>
  <button class="btn-close-menu" onclick="closeSidebar()" id="side_close">إغلاق القائمة</button>
</div>

<div class="header">
  <i class="fas fa-bars" onclick="openSidebar()"></i>
  <div class="header-title" id="head_title">حاسبة BARAKA SAID</div>
  <i class="fas fa-user-circle"></i>
</div>

<div class="container">
  
  <div class="card-timer">
    <span id="display-clock">00:00:00</span>
    <div class="time-stats">
      <span><small id="lbl_start">دخول</small> <b id="val_start">--:--</b></span>
      <span><small id="lbl_end">خروج</small> <b id="val_end">--:--</b></span>
    </div>
    <div class="btn-row">
      <button class="btn-android" onclick="startTracking()" style="background:var(--android-green); color:white" id="btn_in">IN</button>
      <button class="btn-android" onclick="endTracking()" style="background:var(--android-orange); color:white" id="btn_out">OUT</button>
    </div>
  </div>

  <div class="section-title" id="sec_site">الموقع والمهمة</div>
  <div class="card">
    <label id="lbl_cat">فئة المشروع</label>
    <select id="projectCategory"></select>

    <div class="grid-2">
      <div><label id="lbl_nature">طبيعة العمل</label><select id="jobNature"></select></div>
      <div><label id="lbl_urgency">الاستعجالية</label><select id="urgency"></select></div>
    </div>
  </div>

  <div class="section-title" id="sec_tech">التفاصيل التقنية</div>
  <div class="card">
    <label id="lbl_service">الخدمة</label>
    <select id="subService" onchange="toggleInputs(); autoSave();"></select>
    
    <div id="opt-elec">
      <label id="lbl_elec">نوع العمل</label>
      <select id="elecDetail"></select>
    </div>
    <div id="opt-cam" style="display:none">
      <div class="grid-2">
        <div><label id="lbl_cam_n">عدد الكاميرات</label><input type="number" id="camCount" value="1"></div>
        <div><label id="lbl_cam_w">التمديد</label><select id="camWire"></select></div>
      </div>
    </div>
    <div id="opt-led" style="display:none">
      <label id="lbl_led">نوع اللوحة</label>
      <select id="ledType"></select>
    </div>
  </div>

  <div class="section-title" id="sec_wallet">المجهود والمصاريف</div>
  <div class="card">
    <div class="grid-2">
      <div><label id="lbl_h">الساعات</label><input type="number" id="hours" step="0.1" placeholder="0.0"></div>
      <div><label id="lbl_risk">الصعوبة</label><select id="riskFactor"></select></div>
    </div>
    <div class="grid-2">
      <div><label id="lbl_trans">نقل</label><input type="number" id="transport" value="0"></div>
      <div><label id="lbl_parts">سلع</label><input type="number" id="parts" value="0"></div>
    </div>
  </div>

  <button class="btn-main" onclick="calculateFinal()" id="btn_calc">احسب التكلفة</button>

  <div id="resultBox" class="result-box">
    <div class="price" id="grandTotal">0</div>
    <p id="resDetails" style="font-size:0.85rem; color:#444; margin:8px 0;"></p>
    <button onclick="saveToHistory()" style="background:var(--android-navy); color:white; border:none; padding:10px 20px; border-radius:10px; font-weight:bold; width:100%;">
        <i class="fas fa-save"></i> <span id="btn_save">حفظ العملية</span>
    </button>
  </div>

  <div class="section-title" id="sec_hist">السجل الأخير</div>
  <div id="historyList"></div>
</div>

<script>
const dict = {
    ar: {
        head_title: "حاسبة BARAKA SAID", btn_in: "دخول", btn_out: "خروج", lbl_start: "الدخول", lbl_end: "الخروج",
        sec_site: "الموقع والمهمة", sec_tech: "التقنية", sec_wallet: "المصاريف", sec_hist: "السجل العمليات",
        lbl_cat: "فئة المشروع", cat_opts: [{v:40, t:"سكني اقتصادي"}, {v:70, t:"فخم (فيلا)"}, {v:90, t:"تجاري"}, {v:130, t:"صناعي"}],
        lbl_nature: "المهمة", nature_opts: [{v:1, t:"جديد"}, {v:1.2, t:"إصلاح"}, {v:0.8, t:"تكملة"}],
        lbl_urgency: "الاستعجالية", urgency_opts: [{v:1, t:"عادي"}, {v:1.5, t:"مستعجل"}, {v:2, t:"ليل/عطلة"}],
        lbl_service: "الخدمة", services: {elec:"كهرباء", cam:"كاميرات", led:"LED"},
        elec_opts: [{v:0, t:"مفاتيح/مقابس"}, {v:300, t:"لوحة توزيع"}, {v:500, t:"تأسيس كامل"}],
        cam_wire_opts: [{v:50, t:"ظاهري"}, {v:150, t:"داخلي"}],
        led_opts: [{v:300, t:"صليب صيدلية"}, {v:600, t:"مبرمجة"}],
        risk_opts: [{v:1, t:"عادي"}, {v:1.3, t:"خطر"}],
        lbl_h: "الساعات", lbl_risk: "الصعوبة", lbl_trans: "النقل", lbl_parts: "السلع",
        btn_calc: "احسب التكلفة النهائية", btn_save: "حفظ العملية", side_lang: "اللغة", side_clear: "مسح السجل", side_close: "إغلاق القائمة",
        lbl_elec: "نوع العمل", lbl_cam_n: "العدد", lbl_cam_w: "التمديد", lbl_led: "النوع"
    },
    fr: {
        head_title: "Calculatrice BARAKA", btn_in: "IN", btn_out: "OUT", lbl_start: "Entrée", lbl_end: "Sortie",
        sec_site: "SITE & MISSION", sec_tech: "TECHNIQUE", sec_wallet: "FRAIS", sec_hist: "HISTORIQUE",
        lbl_cat: "Projet", cat_opts: [{v:40, t:"Résidentiel"}, {v:70, t:"Villa/Luxe"}, {v:90, t:"Commerce"}, {v:130, t:"Industrie"}],
        lbl_nature: "Nature", nature_opts: [{v:1, t:"Nouveau"}, {v:1.2, t:"Réparation"}, {v:0.8, t:"Finition"}],
        lbl_urgency: "Urgence", urgency_opts: [{v:1, t:"Normal"}, {v:1.5, t:"Urgent"}, {v:2, t:"Nuit/Férié"}],
        lbl_service: "Service", services: {elec:"Élec", cam:"Caméra", led:"LED"},
        elec_opts: [{v:0, t:"Appareillage"}, {v:300, t:"Tableau"}, {v:500, t:"Encastré"}],
        cam_wire_opts: [{v:50, t:"Apparent"}, {v:150, t:"Encastré"}],
        led_opts: [{v:300, t:"Pharmacie"}, {v:600, t:"Programmé"}],
        risk_opts: [{v:1, t:"Normal"}, {v:1.3, t:"Risqué"}],
        lbl_h: "Heures", lbl_risk: "Risque", lbl_trans: "Transp.", lbl_parts: "Pièces",
        btn_calc: "Calculer Total", btn_save: "Enregistrer", side_lang: "Langue", side_clear: "Vider", side_close: "Fermer",
        lbl_elec: "Type", lbl_cam_n: "Nombre", lbl_cam_w: "Câblage", lbl_led: "Type"
    }
};

let history = JSON.parse(localStorage.getItem('bs_hist_v16')) || [];

function applyLanguage() {
    const l = document.getElementById('langSwitcher').value;
    const t = dict[l];
    Object.keys(t).forEach(id => { 
        const el = document.getElementById(id); 
        if(el && typeof t[id] === 'string') el.innerText = t[id];
    });
    fillSelect('projectCategory', t.cat_opts);
    fillSelect('jobNature', t.nature_opts);
    fillSelect('urgency', t.urgency_opts);
    fillSelect('subService', t.services, true);
    fillSelect('elecDetail', t.elec_opts);
    fillSelect('camWire', t.cam_wire_opts);
    fillSelect('ledType', t.led_opts);
    fillSelect('riskFactor', t.risk_opts);
    document.body.dir = (l === 'ar' ? "rtl" : "ltr");
    renderHistory();
}

function fillSelect(id, opts, isObj = false) {
    const el = document.getElementById(id); const val = el.value; el.innerHTML = "";
    if(isObj) Object.keys(opts).forEach(k => el.innerHTML += `<option value="${k}">${opts[k]}</option>`);
    else opts.forEach(o => el.innerHTML += `<option value="${o.v}">${o.t}</option>`);
    if(val) el.value = val;
}

// حفظ الوقت ليكون متاحاً دائماً
function startTracking() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    localStorage.setItem('bs_start_ms', now.getTime());
    localStorage.setItem('bs_start_str', timeStr);
    document.getElementById('val_start').innerText = timeStr;
    document.getElementById('val_end').innerText = "--:--";
}

function endTracking() {
    const startMs = localStorage.getItem('bs_start_ms');
    if(!startMs) return;
    const now = new Date();
    const timeStr = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    document.getElementById('val_end').innerText = timeStr;
    localStorage.setItem('bs_end_str', timeStr);
    
    const hrs = Math.max(0.5, Math.round(((now.getTime() - startMs)/3600000)*10)/10);
    document.getElementById('hours').value = hrs;
}

function calculateFinal() {
    const hrs = parseFloat(document.getElementById('hours').value) || 0;
    const cat = parseFloat(document.getElementById('projectCategory').value);
    const nature = parseFloat(document.getElementById('jobNature').value);
    const urg = parseFloat(document.getElementById('urgency').value);
    const risk = parseFloat(document.getElementById('riskFactor').value);
    
    let work = (hrs * cat * nature * urg * risk);
    const service = document.getElementById('subService').value;
    if(service === 'elec') work += parseFloat(document.getElementById('elecDetail').value);
    else if(service === 'cam') work += (parseInt(document.getElementById('camCount').value)* (100 + parseFloat(document.getElementById('camWire').value)));
    else work += parseFloat(document.getElementById('ledType').value);

    const total = Math.round(work + parseFloat(document.getElementById('transport').value||0) + parseFloat(document.getElementById('parts').value||0));
    const curr = document.getElementById('langSwitcher').value === 'ar' ? "درهم" : "DH";
    document.getElementById('grandTotal').innerText = total.toLocaleString() + " " + curr;
    document.getElementById('resDetails').innerText = `Work: ${Math.round(work)} | Fees: ${parseFloat(document.getElementById('transport').value||0) + parseFloat(document.getElementById('parts').value||0)}`;
    document.getElementById('resultBox').style.display = "block";
    document.getElementById('resultBox').scrollIntoView({behavior:'smooth'});
}

function saveToHistory() {
    const l = document.getElementById('langSwitcher').value;
    const entry = {
        id: Date.now(),
        date: new Date().toLocaleDateString(),
        start: document.getElementById('val_start').innerText,
        end: document.getElementById('val_end').innerText,
        amount: document.getElementById('grandTotal').innerText,
        service: document.getElementById('subService').value
    };
    history.unshift(entry);
    localStorage.setItem('bs_hist_v16', JSON.stringify(history));
    renderHistory();
    alert(l === 'ar' ? "تم الحفظ بنجاح" : "Enregistré!");
}

function renderHistory() {
    const list = document.getElementById('historyList'); list.innerHTML = "";
    history.forEach(i => {
        list.innerHTML += `
            <div class="history-item">
                <div>
                    <b>${i.amount}</b> <span class="hist-meta">(${i.service})</span>
                    <div class="hist-meta">${i.date} | ${i.start} - ${i.end}</div>
                </div>
                <i class="fas fa-trash-alt delete-icon" onclick="deleteItem(${i.id})"></i>
            </div>`;
    });
}

function deleteItem(id) { history = history.filter(i => i.id !== id); localStorage.setItem('bs_hist_v16', JSON.stringify(history)); renderHistory(); }
function clearHistory() { if(confirm("Clear?")) { history = []; localStorage.removeItem('bs_hist_v16'); renderHistory(); } }
function toggleInputs() {
    const s = document.getElementById('subService').value;
    document.getElementById('opt-elec').style.display = (s === 'elec' ? 'block' : 'none');
    document.getElementById('opt-cam').style.display = (s === 'cam' ? 'block' : 'none');
    document.getElementById('opt-led').style.display = (s === 'led' ? 'block' : 'none');
}

function autoSave() {
    localStorage.setItem('bs_lang_v16', document.getElementById('langSwitcher').value);
}

function initApp() {
    setInterval(() => { document.getElementById('display-clock').innerText = new Date().toLocaleTimeString('ar-MA', {hour12:false}); }, 1000);
    
    // استعادة اللغة
    const savedLang = localStorage.getItem('bs_lang_v16');
    if(savedLang) document.getElementById('langSwitcher').value = savedLang;
    
    // استعادة الوقت المحفوظ (IN / OUT)
    const sStr = localStorage.getItem('bs_start_str');
    const eStr = localStorage.getItem('bs_end_str');
    if(sStr) document.getElementById('val_start').innerText = sStr;
    if(eStr) document.getElementById('val_end').innerText = eStr;

    applyLanguage();
    toggleInputs();
    renderHistory();
}

function openSidebar() { document.getElementById("mySidebar").style.width = "280px"; document.getElementById("overlay").style.display = "block"; }
function closeSidebar() { document.getElementById("mySidebar").style.width = "0"; document.getElementById("overlay").style.display = "none"; }
</script>
</body>
</html>
