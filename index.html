<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Golden Logistics Pro | Baraka Said</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;800&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #020617; --card: rgba(30, 41, 59, 0.4); --text: #f8fafc; --border: rgba(255,255,255,0.05); }
        .light-mode { --bg: #f1f5f9; --card: rgba(255, 255, 255, 0.8); --text: #0f172a; --border: rgba(0,0,0,0.1); }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--bg); color: var(--text); height: 100vh; overflow: hidden; margin: 0; transition: background 0.3s; display: flex; flex-direction: column; }
        .glass-card { background: var(--card); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 12px; }
        .info-grid { display: grid; grid-template-columns: 0.8fr 1fr 1fr 1fr; gap: 6px; min-height: 75px; margin-bottom: 10px; flex-shrink: 0; }
        .info-box { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4px; text-align: center; border-bottom: 3px solid transparent; }
        .info-label { font-size: 9px; font-weight: 800; text-transform: uppercase; margin-bottom: 2px; }
        .info-value { font-size: 11px; font-weight: 900; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 100%; }
        .table-container { flex: 1; overflow: hidden; display: flex; flex-direction: column; }
        table { width: 100%; height: 100%; table-layout: fixed; border-spacing: 4px; border-collapse: separate; }
        th { font-size: 9px; padding-bottom: 4px; text-align: center; color: #64748b; }
        td { height: calc(100% / 7); padding: 0; width: 25%; }
        .cell-content { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        .day-name { color: #38bdf8; font-weight: 800; font-size: 10px; }
        select { background: transparent; border: none; width: 100%; text-align: center; color: inherit; font-size: 10px; font-weight: bold; outline: none; appearance: none; cursor: pointer; }
        .sidebar { position: fixed; inset-y: 0; width: 280px; background: var(--bg); z-index: 1000; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); border-inline-end: 1px solid var(--border); }
        .rtl .sidebar { right: 0; transform: translateX(100%); }
        .rtl .sidebar.open { transform: translateX(0); }
        .ltr .sidebar { left: 0; transform: translateX(-100%); }
        .ltr .sidebar.open { transform: translateX(0); }
        #copyToast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #10b981; color: white; padding: 8px 20px; border-radius: 30px; font-size: 12px; font-weight: bold; z-index: 4000; display: none; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
        .error-shake { animation: shake 0.3s ease-in-out; }
        .call-btn { background: rgba(34, 197, 94, 0.15); padding: 4px; border-radius: 50%; color: #4ade80; transition: 0.2s; border: none; cursor: pointer; }
    </style>
</head>
<body class="rtl">

    <div id="copyToast">ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¨Ù†Ø¬Ø§Ø­!</div>

    <div id="sidebar" class="sidebar p-6 flex flex-col shadow-2xl">
        <div class="flex justify-between items-center mb-8">
            <span class="font-bold text-sky-500 text-sm tracking-widest">MENU | Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
            <button onclick="toggleSidebar()" class="text-2xl text-slate-400">âœ•</button>
        </div>
        <div class="space-y-4 flex-1">
            <button onclick="toggleTheme()" class="w-full flex justify-between p-4 glass-card rounded-xl text-xs font-bold">
                <span>Ø§Ù„ÙˆØ¶Ø¹ / Mode</span><span id="themeIcon">ğŸŒ™</span>
            </button>
            <button onclick="toggleLang()" class="w-full flex justify-between p-4 glass-card rounded-xl text-xs font-bold">
                <span>Ø§Ù„Ù„ØºØ© / Langue</span><span>ğŸŒ</span>
            </button>
        </div>
        <div class="pt-6 border-t border-slate-800 text-center">
            <div class="bg-sky-500/5 p-4 rounded-xl mb-4 border border-sky-500/10">
                <p class="text-[10px] text-sky-400 font-bold uppercase mb-1">Developer</p>
                <p class="text-sm font-bold text-white">Baraka Said</p>
                <p class="text-[9px] text-slate-500">techno.said.gt@gmail.com</p>
            </div>
            <p class="text-[10px] text-sky-400/80 italic font-medium">Ø§Ù„Ù„Ù‡Ù… Ø§ØºÙØ± Ù„ÙˆØ§Ù„Ø¯ØªÙŠ ÙˆØ§Ø±Ø­Ù…Ù‡Ø§</p>
        </div>
    </div>

    <div class="p-2 h-full flex flex-col max-w-2xl mx-auto w-full">
        <header class="flex justify-between items-center mb-2 px-1 flex-shrink-0">
            <button onclick="toggleSidebar()" class="p-2 glass-card text-sky-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h7" stroke-width="2.5"></path></svg>
            </button>
            <div class="text-center">
                <h1 class="text-[11px] font-black tracking-widest uppercase">GOLDEN <span class="text-sky-500">LOGISTICS</span></h1>
                <div id="clock" class="text-[10px] font-bold text-slate-500 font-mono"></div>
            </div>
            <button onclick="handleEdit()" id="editBtn" class="bg-sky-500 text-white px-4 py-1.5 rounded-lg text-[10px] font-black uppercase shadow-lg shadow-sky-500/20">ØªØ¹Ø¯ÙŠÙ„</button>
        </header>

        <div class="info-grid">
            <div class="glass-card info-box border-sky-500">
                <span class="info-label text-slate-500" id="labelW">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span>
                <select id="weekSelect" onchange="changeWeekManually()" disabled class="text-sky-500 font-black">
                    <option value="1">W 1</option><option value="2">W 2</option>
                    <option value="3">W 3</option><option value="4">W 4</option>
                </select>
            </div>
            <div class="glass-card info-box border-green-500">
                <span class="info-label text-green-500" id="labelNow">Ø§Ù„Ø­Ø§Ù„ÙŠ</span>
                <span id="activeStaff" class="info-value text-green-400">...</span>
                <div id="callNow" class="flex gap-1 mt-1"></div>
            </div>
            <div class="glass-card info-box border-sky-400">
                <span class="info-label text-sky-400" id="labelNext">Ø§Ù„ØªØ§Ù„ÙŠ</span>
                <span id="nextStaff" class="info-value text-sky-300">...</span>
                <div id="callNext" class="flex gap-1 mt-1"></div>
            </div>
            <div class="glass-card info-box border-rose-500">
                <span class="info-label text-rose-500" id="labelOff">Ø§Ù„Ø¹Ø·Ù„Ø©</span>
                <span id="offStaff" class="info-value text-rose-400">...</span>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th id="thDay">Ø§Ù„ÙŠÙˆÙ…</th>
                        <th id="thShift1">09:00-16:00</th>
                        <th id="thShift2">16:00-01:00</th>
                        <th id="thShift3">01:00-09:00</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <div id="passModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center z-[2000] p-6">
        <div id="passCard" class="glass-card w-full max-w-xs p-6 text-center border-t-4 border-sky-500">
            <h2 id="passTitle" class="text-sky-500 font-black mb-4 text-sm uppercase tracking-widest">Security Check</h2>
            <input type="password" id="passInput" class="w-full p-4 bg-slate-900 border border-slate-700 rounded-2xl text-center mb-4 text-white outline-none" placeholder="â€¢â€¢â€¢â€¢">
            <div class="flex gap-2">
                <button onclick="closeModal()" class="flex-1 p-3 bg-slate-800 rounded-xl text-xs font-bold uppercase">Ø¥Ù„ØºØ§Ø¡</button>
                <button onclick="checkPass()" class="flex-1 p-3 bg-sky-500 rounded-xl text-xs font-bold uppercase text-white">Ø¯Ø®ÙˆÙ„</button>
            </div>
        </div>
    </div>

    <script>
        /* =========================================
           Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØª ÙˆØ§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹)
           =========================================
        */
        const SCHEDULE_CONFIG = {
            // Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª (Ø§Ù„Ø³Ø§Ø¹Ø© Ø¨Ù†Ø¸Ø§Ù… 24 Ø³Ø§Ø¹Ø©)
            shifts: {
                s1: { start: 9,  end: 16, label: "09:00-16:00" },
                s2: { start: 16, end: 1,  label: "16:00-01:00" }, // 1 ØªØ¹Ù†ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© ØµØ¨Ø§Ø­Ø§Ù‹
                s3: { start: 1,  end: 9,  label: "01:00-09:00" }
            },
            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            autoRotateWeeks: true, // Ø§Ø¬Ø¹Ù„Ù‡Ø§ false Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª ØªØ«Ø¨ÙŠØª Ø£Ø³Ø¨ÙˆØ¹ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¯Ø§Ø¦Ù…Ø§Ù‹
            totalWeeks: 4
        };

        const phoneBook = { "Youness": "0697277839", "Said": "https://wa.me/qr/LFD2FXYV7HALL1", "Mohamed": "0668344926", "Youssef": "+212707760899" };
        const staffNames = ["Youness", "Mohamed", "Said", "Youssef"];
        
        const trans = {
            ar: { days: ["Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª","Ø§Ù„Ø£Ø­Ø¯"], edit: "ØªØ¹Ø¯ÙŠÙ„", save: "Ø­ÙØ¸", now: "Ø§Ù„Ø­Ø§Ù„ÙŠ", next: "Ø§Ù„ØªØ§Ù„ÙŠ", off: "Ø§Ù„Ø¹Ø·Ù„Ø©", w: "Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹", day: "Ø§Ù„ÙŠÙˆÙ…" },
            fr: { days: ["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"], edit: "Modifier", save: "Sauver", now: "Actuel", next: "Suivant", off: "Repos", w: "Semaine", day: "Jour" }
        };

        let lang = localStorage.getItem('g_lang') || 'ar';
        let theme = localStorage.getItem('g_theme') || 'dark';
        let isEdit = false;
        let week = "1";

        // Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø±Ù‚Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ (ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
        function getCurrentSystemWeek() {
            const now = new Date();
            const startOfYear = new Date(now.getFullYear(), 0, 1);
            const pastDaysOfYear = (now - startOfYear) / 86400000;
            const weekNumber = Math.ceil((pastDaysOfYear + startOfYear.getDay() + 1) / 7);
            // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø¹Ù„Ù‰ Ø­Ù„Ù‚Ø© Ù…Ù† 1 Ø¥Ù„Ù‰ 4
            return ((weekNumber - 1) % SCHEDULE_CONFIG.totalWeeks) + 1;
        }

        function initData() {
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø£Ùˆ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            if (SCHEDULE_CONFIG.autoRotateWeeks) {
                week = getCurrentSystemWeek().toString();
            } else {
                week = localStorage.getItem('g_week') || "1";
            }

            if(!localStorage.getItem('g_data')) {
                const dayTemplate = { s1: ["Youness", "Said"], s2: "Mohamed", s3: "Youssef" };
                const weekData = Array(7).fill(null).map(() => JSON.parse(JSON.stringify(dayTemplate)));
                const fullData = {};
                for(let i=1; i<=SCHEDULE_CONFIG.totalWeeks; i++) fullData[i] = weekData;
                localStorage.setItem('g_data', JSON.stringify(fullData));
            }
        }

        function updateUI() {
            const t = trans[lang];
            document.body.className = (lang === 'ar' ? 'rtl ' : 'ltr ') + (theme === 'light' ? 'light-mode' : '');
            document.getElementById('editBtn').innerText = isEdit ? t.save : t.edit;
            document.getElementById('weekSelect').disabled = !isEdit;
            document.getElementById('weekSelect').value = week;
            document.getElementById('labelW').innerText = t.w;
            document.getElementById('labelNow').innerText = t.now;
            document.getElementById('labelNext').innerText = t.next;
            document.getElementById('labelOff').innerText = t.off;
            document.getElementById('thDay').innerText = t.day;
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            document.getElementById('thShift1').innerText = SCHEDULE_CONFIG.shifts.s1.label;
            document.getElementById('thShift2').innerText = SCHEDULE_CONFIG.shifts.s2.label;
            document.getElementById('thShift3').innerText = SCHEDULE_CONFIG.shifts.s3.label;

            const data = JSON.parse(localStorage.getItem('g_data'))[week];
            document.getElementById('tableBody').innerHTML = data.map((d, i) => `
                <tr>
                    <td class="glass-card"><div class="cell-content"><span class="day-name">${t.days[i]}</span></div></td>
                    <td class="glass-card">
                        <div class="cell-content gap-1">
                            <select ${!isEdit?'disabled':''} class="text-sky-400" onchange="saveData(${i},'s1',0,this.value)">${staffNames.concat("None").map(s=>`<option ${s==d.s1[0]?'selected':''}>${s}</option>`).join('')}</select>
                            <div class="w-2/3 h-[1px] bg-white/10"></div>
                            <select ${!isEdit?'disabled':''} class="text-sky-400" onchange="saveData(${i},'s1',1,this.value)">${staffNames.concat("None").map(s=>`<option ${s==d.s1[1]?'selected':''}>${s}</option>`).join('')}</select>
                        </div>
                    </td>
                    <td class="glass-card"><div class="cell-content"><select ${!isEdit?'disabled':''} class="text-orange-400" onchange="saveData(${i},'s2',null,this.value)">${staffNames.concat("None").map(s=>`<option ${s==d.s2?'selected':''}>${s}</option>`).join('')}</select></div></td>
                    <td class="glass-card"><div class="cell-content"><select ${!isEdit?'disabled':''} class="text-purple-400" onchange="saveData(${i},'s3',null,this.value)">${staffNames.concat("None").map(s=>`<option ${s==d.s3?'selected':''}>${s}</option>`).join('')}</select></div></td>
                </tr>
            `).join('');
            refreshLiveInfo();
        }

        function refreshLiveInfo() {
            const now = new Date();
            const hour = now.getHours();
            const dayIdx = (now.getDay() + 6) % 7;
            const data = JSON.parse(localStorage.getItem('g_data'))[week][dayIdx];
            
            const conf = SCHEDULE_CONFIG.shifts;
            let cur = "", nxt = "";

            // Ù…Ù†Ø·Ù‚ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø´ÙØª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø§Ø¹Ø© (Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ)
            if(hour >= conf.s1.start && hour < conf.s1.end) { 
                cur = data.s1.join(" & "); nxt = data.s2; 
            } else if(hour >= conf.s2.start || hour < conf.s2.end) { 
                cur = data.s2; nxt = data.s3; 
            } else { 
                cur = data.s3; nxt = data.s1.join(" & "); 
            }

            const clean = (s) => s.replace(/None| & None|None & /g, "").trim() || "...";
            document.getElementById('activeStaff').innerText = clean(cur);
            document.getElementById('nextStaff').innerText = clean(nxt);
            
            const off = staffNames.filter(s => ![...data.s1, data.s2, data.s3].includes(s));
            document.getElementById('offStaff').innerText = off.join(" & ") || "None";
            
            const callIcon = (n) => `<button onclick="handleAction('${n.trim()}')" class="call-btn"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path></svg></button>`;
            document.getElementById('callNow').innerHTML = clean(cur).split("&").map(n => phoneBook[n.trim()] ? callIcon(n) : "").join("");
            document.getElementById('callNext').innerHTML = clean(nxt).split("&").map(n => phoneBook[n.trim()] ? callIcon(n) : "").join("");
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function handleEdit() { if(isEdit) { isEdit = false; updateUI(); } else { document.getElementById('passModal').classList.remove('hidden'); } }
        function closeModal() { document.getElementById('passModal').classList.add('hidden'); }
        function checkPass() { if(document.getElementById('passInput').value === "1990") { isEdit = true; closeModal(); updateUI(); } }
        function saveData(day, shift, sub, val) {
            let all = JSON.parse(localStorage.getItem('g_data'));
            if(sub === null) all[week][day][shift] = val; else all[week][day][shift][sub] = val;
            localStorage.setItem('g_data', JSON.stringify(all));
            refreshLiveInfo();
        }
        function changeWeekManually() { week = document.getElementById('weekSelect').value; updateUI(); }
        function toggleLang() { lang = lang === 'ar' ? 'fr' : 'ar'; localStorage.setItem('g_lang', lang); updateUI(); }
        function toggleTheme() { theme = theme === 'dark' ? 'light' : 'dark'; localStorage.setItem('g_theme', theme); updateUI(); }

        window.onload = () => {
            initData();
            updateUI();
            setInterval(() => {
                const n = new Date();
                document.getElementById('clock').innerText = `${n.toLocaleDateString(lang==='ar'?'ar-MA':'fr-FR',{weekday:'long'})} | ${n.toLocaleTimeString('en-GB')}`;
                if(n.getMinutes() === 0 && n.getSeconds() === 0) {
                    if(SCHEDULE_CONFIG.autoRotateWeeks) week = getCurrentSystemWeek().toString();
                    refreshLiveInfo();
                }
            }, 1000);
        };
    </script>
</body>
</html>
